#include "RTSPCapturer.h"
#include <iostream>
#include "opencv2/core/core.hpp"
#include "opencv2/contrib/contrib.hpp"
#include "opencv2/highgui/highgui.hpp"
using namespace std;

RTSPCapturer::RTSPCapturer(char* Url)
{
<<<<<<< HEAD

    capture = NULL;
    capture = cvCreateFileCapture(Url);  //Capture rtsp camera

    cout << capture << endl;
    IplImage* frame = cvQueryFrame(capture);
    Mat imgMat(frame);

    /*string filen(Url);
    cout << filen << endl;
    VideoCapture cap;
    cout << Url << endl;
    cap.open(filen);
    cout << cap.isOpened() << endl;
    cap.read(imgMat);
    cout << imgMat << endl;*/
    namedWindow("TEST", CV_WINDOW_AUTOSIZE);

    imshow("test", imgMat);

    /*if(capture == NULL)
    {
        throw Exception();
    }*/
=======
    if(!vcap.open(Url)) {
            cout << "Error opening video stream or file" << endl;
            throw Exception();
        }
>>>>>>> 9063a703fcafb7a518b0a598dbcf7af4d9c758e7

    data = new ImageData();
    //cout << "here2" << endl;
}

RTSPCapturer::~RTSPCapturer()
{
    vcap.~VideoCapture();
    delete data;
}

ImageData* RTSPCapturer::getNextImage()
{
<<<<<<< HEAD
    data->faces.clear();

    IplImage* frame = cvQueryFrame(capture);
    if (frame == NULL)
=======
    Mat image;

    if(!vcap.read(image))
    {
        cout << "No frame" << endl;
>>>>>>> 9063a703fcafb7a518b0a598dbcf7af4d9c758e7
        return NULL;
    }

    data->image = image;

    QDate cd = QDate::currentDate();
    QTime ct = QTime::currentTime();

    data->timestamp.setDate(cd);
    data->timestamp.setTime(ct);

    return data;
}
